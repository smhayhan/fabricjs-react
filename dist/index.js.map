{"version":3,"file":"index.js","sources":["../src/defaultShapes.tsx","../src/editor.tsx","../src/index.tsx"],"sourcesContent":["export const STROKE = '#000000'\nexport const FILL = 'rgba(255, 255, 255, 0.0)'\n\nexport const CIRCLE = {\n  radius: 20,\n  left: 100,\n  top: 100,\n  fill: FILL,\n  stroke: STROKE\n}\n\nexport const RECTANGLE = {\n  left: 100,\n  top: 100,\n  fill: FILL,\n  stroke: STROKE,\n  width: 40,\n  height: 40,\n  angle: 0\n}\n\nexport const LINE = {\n  points: [50, 100, 200, 200],\n  options: {\n    left: 170,\n    top: 150,\n    stroke: STROKE\n  }\n}\n\nexport const TEXT = {\n  type: 'text',\n  left: 100,\n  top: 100,\n  fontSize: 16,\n  fontFamily: 'Arial',\n  fill: STROKE\n}\n","import { fabric } from 'fabric'\nimport { CIRCLE, RECTANGLE, LINE, TEXT, FILL, STROKE } from './defaultShapes'\nimport { useEffect, useState } from 'react'\nimport { IRectOptions } from 'fabric/fabric-impl'\n\nexport interface FabricJSEditor {\n  canvas: fabric.Canvas\n  addCircle: () => void\n  addRectangle: (config?: IRectOptions) => void\n  addLine: () => void\n  addText: (text: string) => void\n  updateText: (text: string) => void\n  deleteAll: () => void\n  deleteSelected: () => void\n  fillColor: string\n  strokeColor: string\n  setFillColor: (color: string) => void\n  setStrokeColor: (color: string) => void\n  zoomIn: () => void\n  zoomOut: () => void\n}\n\n/**\n * Creates editor\n */\nconst buildEditor = (\n  canvas: fabric.Canvas,\n  fillColor: string,\n  strokeColor: string,\n  _setFillColor: (color: string) => void,\n  _setStrokeColor: (color: string) => void,\n  scaleStep: number\n): FabricJSEditor => {\n  return {\n    canvas,\n    addCircle: () => {\n      const object = new fabric.Circle({\n        ...CIRCLE,\n        fill: fillColor,\n        stroke: strokeColor\n      })\n      canvas.add(object)\n    },\n    addRectangle: (config?: IRectOptions) => {\n      const object = new fabric.Rect({\n        ...RECTANGLE,\n        fill: fillColor,\n        stroke: strokeColor,\n        ...config\n      })\n      canvas.add(object)\n    },\n    addLine: () => {\n      const object = new fabric.Line(LINE.points, {\n        ...LINE.options,\n        stroke: strokeColor\n      })\n      canvas.add(object)\n    },\n    addText: (text: string) => {\n      // use stroke in text fill, fill default is most of the time transparent\n      const object = new fabric.Textbox(text, { ...TEXT, fill: strokeColor })\n      object.set({ text: text })\n      canvas.add(object)\n    },\n    updateText: (text: string) => {\n      const objects: any[] = canvas.getActiveObjects()\n      if (objects.length && objects[0].type === TEXT.type) {\n        const textObject: fabric.Textbox = objects[0]\n        textObject.set({ text })\n        canvas.renderAll()\n      }\n    },\n    deleteAll: () => {\n      canvas.getObjects().forEach((object) => canvas.remove(object))\n      canvas.discardActiveObject()\n      canvas.renderAll()\n    },\n    deleteSelected: () => {\n      canvas.getActiveObjects().forEach((object) => canvas.remove(object))\n      canvas.discardActiveObject()\n      canvas.renderAll()\n    },\n    fillColor,\n    strokeColor,\n    setFillColor: (fill: string) => {\n      _setFillColor(fill)\n      canvas.getActiveObjects().forEach((object) => object.set({ fill }))\n      canvas.renderAll()\n    },\n    setStrokeColor: (stroke: string) => {\n      _setStrokeColor(stroke)\n      canvas.getActiveObjects().forEach((object) => {\n        if (object.type === TEXT.type) {\n          // use stroke in text fill\n          object.set({ fill: stroke })\n          return\n        }\n        object.set({ stroke })\n      })\n      canvas.renderAll()\n    },\n    zoomIn: () => {\n      const zoom = canvas.getZoom()\n      canvas.setZoom(zoom / scaleStep)\n    },\n    zoomOut: () => {\n      const zoom = canvas.getZoom()\n      canvas.setZoom(zoom * scaleStep)\n    }\n  }\n}\n\ninterface FabricJSEditorState {\n  editor?: FabricJSEditor\n}\n\ninterface FabricJSEditorHook extends FabricJSEditorState {\n  selectedObjects?: fabric.Object[]\n  onReady: (canvas: fabric.Canvas) => void\n}\n\ninterface FabricJSEditorHookProps {\n  defaultFillColor?: string\n  defaultStrokeColor?: string\n  scaleStep?: number\n}\n\nconst useFabricJSEditor = (\n  props: FabricJSEditorHookProps = {}\n): FabricJSEditorHook => {\n  const scaleStep = props.scaleStep || 0.5\n  const { defaultFillColor, defaultStrokeColor } = props\n  const [canvas, setCanvas] = useState<null | fabric.Canvas>(null)\n  const [fillColor, setFillColor] = useState<string>(defaultFillColor || FILL)\n  const [strokeColor, setStrokeColor] = useState<string>(\n    defaultStrokeColor || STROKE\n  )\n  const [selectedObjects, setSelectedObject] = useState<fabric.Object[]>([])\n  useEffect(() => {\n    const bindEvents = (canvas: fabric.Canvas) => {\n      canvas.on('selection:cleared', () => {\n        setSelectedObject([])\n      })\n      canvas.on('selection:created', (e: any) => {\n        setSelectedObject(e.selected)\n      })\n      canvas.on('selection:updated', (e: any) => {\n        setSelectedObject(e.selected)\n      })\n    }\n    if (canvas) {\n      bindEvents(canvas)\n    }\n  }, [canvas])\n\n  return {\n    selectedObjects,\n    onReady: (canvasReady: fabric.Canvas): void => {\n      console.log('Fabric canvas ready')\n      setCanvas(canvasReady)\n    },\n    editor: canvas\n      ? buildEditor(\n          canvas,\n          fillColor,\n          strokeColor,\n          setFillColor,\n          setStrokeColor,\n          scaleStep\n        )\n      : undefined\n  }\n}\n\nexport { buildEditor, useFabricJSEditor, FabricJSEditorHook }\n","import React, { useEffect, useRef } from 'react'\nimport { fabric } from 'fabric'\nimport { useFabricJSEditor, FabricJSEditor, FabricJSEditorHook } from './editor'\n\nexport interface Props {\n  className?: string\n  onReady?: (canvas: fabric.Canvas) => void\n}\n\n/**\n * Fabric canvas as component\n */\nconst FabricJSCanvas = ({ className, onReady }: Props) => {\n  const canvasEl = useRef(null)\n  const canvasElParent = useRef<HTMLDivElement>(null)\n  useEffect(() => {\n    const canvas = new fabric.Canvas(canvasEl.current)\n    const setCurrentDimensions = () => {\n      canvas.setHeight(canvasElParent.current?.clientHeight || 0)\n      canvas.setWidth(canvasElParent.current?.clientWidth || 0)\n      canvas.renderAll()\n    }\n    const resizeCanvas = () => {\n      setCurrentDimensions()\n    }\n    setCurrentDimensions()\n\n    window.addEventListener('resize', resizeCanvas, false)\n\n    if (onReady) {\n      onReady(canvas)\n    }\n\n    return () => {\n      canvas.dispose()\n      window.removeEventListener('resize', resizeCanvas)\n    }\n  }, [])\n  return (\n    <div ref={canvasElParent} className={className}>\n      <canvas ref={canvasEl} />\n    </div>\n  )\n}\n\nexport { FabricJSEditor, FabricJSCanvas, FabricJSEditorHook, useFabricJSEditor }\n"],"names":["STROKE","FILL","CIRCLE","radius","left","top","fill","stroke","RECTANGLE","width","height","angle","LINE","points","options","TEXT","type","fontSize","fontFamily","buildEditor","canvas","fillColor","strokeColor","_setFillColor","_setStrokeColor","scaleStep","addCircle","object","fabric","Circle","add","addRectangle","config","Rect","addLine","Line","addText","text","Textbox","set","updateText","objects","getActiveObjects","length","textObject","renderAll","deleteAll","getObjects","forEach","remove","discardActiveObject","deleteSelected","setFillColor","setStrokeColor","zoomIn","zoom","getZoom","setZoom","zoomOut","useFabricJSEditor","props","defaultFillColor","defaultStrokeColor","useState","setCanvas","selectedObjects","setSelectedObject","useEffect","bindEvents","on","e","selected","onReady","canvasReady","console","log","editor","undefined","FabricJSCanvas","className","canvasEl","useRef","canvasElParent","Canvas","current","setCurrentDimensions","setHeight","clientHeight","setWidth","clientWidth","resizeCanvas","window","addEventListener","dispose","removeEventListener","React","ref"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAO,IAAMA,MAAM,GAAG,SAAf;AACA,IAAMC,IAAI,GAAG,0BAAb;AAEA,IAAMC,MAAM,GAAG;EACpBC,MAAM,EAAE,EADY;EAEpBC,IAAI,EAAE,GAFc;EAGpBC,GAAG,EAAE,GAHe;EAIpBC,IAAI,EAAEL,IAJc;EAKpBM,MAAM,EAAEP;AALY,CAAf;AAQA,IAAMQ,SAAS,GAAG;EACvBJ,IAAI,EAAE,GADiB;EAEvBC,GAAG,EAAE,GAFkB;EAGvBC,IAAI,EAAEL,IAHiB;EAIvBM,MAAM,EAAEP,MAJe;EAKvBS,KAAK,EAAE,EALgB;EAMvBC,MAAM,EAAE,EANe;EAOvBC,KAAK,EAAE;AAPgB,CAAlB;AAUA,IAAMC,IAAI,GAAG;EAClBC,MAAM,EAAE,CAAC,EAAD,EAAK,GAAL,EAAU,GAAV,EAAe,GAAf,CADU;EAElBC,OAAO,EAAE;IACPV,IAAI,EAAE,GADC;IAEPC,GAAG,EAAE,GAFE;IAGPE,MAAM,EAAEP;;AALQ,CAAb;AASA,IAAMe,IAAI,GAAG;EAClBC,IAAI,EAAE,MADY;EAElBZ,IAAI,EAAE,GAFY;EAGlBC,GAAG,EAAE,GAHa;EAIlBY,QAAQ,EAAE,EAJQ;EAKlBC,UAAU,EAAE,OALM;EAMlBZ,IAAI,EAAEN;AANY,CAAb;;ACLP,IAAMmB,WAAW,GAAG,SAAdA,WAAc,CAClBC,MADkB,EAElBC,SAFkB,EAGlBC,WAHkB,EAIlBC,aAJkB,EAKlBC,eALkB,EAMlBC,SANkB;EAQlB,OAAO;IACLL,MAAM,EAANA,MADK;IAELM,SAAS,EAAE;MACT,IAAMC,MAAM,GAAG,IAAIC,aAAM,CAACC,MAAX,cACV3B,MADU;QAEbI,IAAI,EAAEe,SAFO;QAGbd,MAAM,EAAEe;SAHV;MAKAF,MAAM,CAACU,GAAP,CAAWH,MAAX;KARG;IAULI,YAAY,EAAE,sBAACC,MAAD;MACZ,IAAML,MAAM,GAAG,IAAIC,aAAM,CAACK,IAAX,cACVzB,SADU;QAEbF,IAAI,EAAEe,SAFO;QAGbd,MAAM,EAAEe;SACLU,MAJU,EAAf;MAMAZ,MAAM,CAACU,GAAP,CAAWH,MAAX;KAjBG;IAmBLO,OAAO,EAAE;MACP,IAAMP,MAAM,GAAG,IAAIC,aAAM,CAACO,IAAX,CAAgBvB,IAAI,CAACC,MAArB,eACVD,IAAI,CAACE,OADK;QAEbP,MAAM,EAAEe;SAFV;MAIAF,MAAM,CAACU,GAAP,CAAWH,MAAX;KAxBG;IA0BLS,OAAO,EAAE,iBAACC,IAAD;MAEP,IAAMV,MAAM,GAAG,IAAIC,aAAM,CAACU,OAAX,CAAmBD,IAAnB,eAA8BtB,IAA9B;QAAoCT,IAAI,EAAEgB;SAAzD;MACAK,MAAM,CAACY,GAAP,CAAW;QAAEF,IAAI,EAAEA;OAAnB;MACAjB,MAAM,CAACU,GAAP,CAAWH,MAAX;KA9BG;IAgCLa,UAAU,EAAE,oBAACH,IAAD;MACV,IAAMI,OAAO,GAAUrB,MAAM,CAACsB,gBAAP,EAAvB;;MACA,IAAID,OAAO,CAACE,MAAR,IAAkBF,OAAO,CAAC,CAAD,CAAP,CAAWzB,IAAX,KAAoBD,IAAI,CAACC,IAA/C,EAAqD;QACnD,IAAM4B,UAAU,GAAmBH,OAAO,CAAC,CAAD,CAA1C;QACAG,UAAU,CAACL,GAAX,CAAe;UAAEF,IAAI,EAAJA;SAAjB;QACAjB,MAAM,CAACyB,SAAP;;KArCC;IAwCLC,SAAS,EAAE;MACT1B,MAAM,CAAC2B,UAAP,GAAoBC,OAApB,CAA4B,UAACrB,MAAD;QAAA,OAAYP,MAAM,CAAC6B,MAAP,CAActB,MAAd,CAAZ;OAA5B;MACAP,MAAM,CAAC8B,mBAAP;MACA9B,MAAM,CAACyB,SAAP;KA3CG;IA6CLM,cAAc,EAAE;MACd/B,MAAM,CAACsB,gBAAP,GAA0BM,OAA1B,CAAkC,UAACrB,MAAD;QAAA,OAAYP,MAAM,CAAC6B,MAAP,CAActB,MAAd,CAAZ;OAAlC;MACAP,MAAM,CAAC8B,mBAAP;MACA9B,MAAM,CAACyB,SAAP;KAhDG;IAkDLxB,SAAS,EAATA,SAlDK;IAmDLC,WAAW,EAAXA,WAnDK;IAoDL8B,YAAY,EAAE,sBAAC9C,IAAD;MACZiB,aAAa,CAACjB,IAAD,CAAb;;MACAc,MAAM,CAACsB,gBAAP,GAA0BM,OAA1B,CAAkC,UAACrB,MAAD;QAAA,OAAYA,MAAM,CAACY,GAAP,CAAW;UAAEjC,IAAI,EAAJA;SAAb,CAAZ;OAAlC;MACAc,MAAM,CAACyB,SAAP;KAvDG;IAyDLQ,cAAc,EAAE,wBAAC9C,MAAD;MACdiB,eAAe,CAACjB,MAAD,CAAf;;MACAa,MAAM,CAACsB,gBAAP,GAA0BM,OAA1B,CAAkC,UAACrB,MAAD;QAChC,IAAIA,MAAM,CAACX,IAAP,KAAgBD,IAAI,CAACC,IAAzB,EAA+B;UAE7BW,MAAM,CAACY,GAAP,CAAW;YAAEjC,IAAI,EAAEC;WAAnB;UACA;;;QAEFoB,MAAM,CAACY,GAAP,CAAW;UAAEhC,MAAM,EAANA;SAAb;OANF;MAQAa,MAAM,CAACyB,SAAP;KAnEG;IAqELS,MAAM,EAAE;MACN,IAAMC,IAAI,GAAGnC,MAAM,CAACoC,OAAP,EAAb;MACApC,MAAM,CAACqC,OAAP,CAAeF,IAAI,GAAG9B,SAAtB;KAvEG;IAyELiC,OAAO,EAAE;MACP,IAAMH,IAAI,GAAGnC,MAAM,CAACoC,OAAP,EAAb;MACApC,MAAM,CAACqC,OAAP,CAAeF,IAAI,GAAG9B,SAAtB;;GA3EJ;AA8ED,CAtFD;;AAuGA,IAAMkC,iBAAiB,GAAG,SAApBA,iBAAoB,CACxBC,KADwB;MACxBA;IAAAA,QAAiC;;;EAEjC,IAAMnC,SAAS,GAAGmC,KAAK,CAACnC,SAAN,IAAmB,GAArC;EACA,aAAiDmC,KAAjD;MAAQC,gBAAR,UAAQA,gBAAR;MAA0BC,kBAA1B,UAA0BA,kBAA1B;;EACA,gBAA4BC,cAAQ,CAAuB,IAAvB,CAApC;MAAO3C,MAAP;MAAe4C,SAAf;;EACA,iBAAkCD,cAAQ,CAASF,gBAAgB,IAAI5D,IAA7B,CAA1C;MAAOoB,SAAP;MAAkB+B,YAAlB;;EACA,iBAAsCW,cAAQ,CAC5CD,kBAAkB,IAAI9D,MADsB,CAA9C;MAAOsB,WAAP;MAAoB+B,cAApB;;EAGA,iBAA6CU,cAAQ,CAAkB,EAAlB,CAArD;MAAOE,eAAP;MAAwBC,iBAAxB;;EACAC,eAAS,CAAC;IACR,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAAChD,MAAD;MACjBA,MAAM,CAACiD,EAAP,CAAU,mBAAV,EAA+B;QAC7BH,iBAAiB,CAAC,EAAD,CAAjB;OADF;MAGA9C,MAAM,CAACiD,EAAP,CAAU,mBAAV,EAA+B,UAACC,CAAD;QAC7BJ,iBAAiB,CAACI,CAAC,CAACC,QAAH,CAAjB;OADF;MAGAnD,MAAM,CAACiD,EAAP,CAAU,mBAAV,EAA+B,UAACC,CAAD;QAC7BJ,iBAAiB,CAACI,CAAC,CAACC,QAAH,CAAjB;OADF;KAPF;;IAWA,IAAInD,MAAJ,EAAY;MACVgD,UAAU,CAAChD,MAAD,CAAV;;GAbK,EAeN,CAACA,MAAD,CAfM,CAAT;EAiBA,OAAO;IACL6C,eAAe,EAAfA,eADK;IAELO,OAAO,EAAE,iBAACC,WAAD;MACPC,OAAO,CAACC,GAAR,CAAY,qBAAZ;MACAX,SAAS,CAACS,WAAD,CAAT;KAJG;IAMLG,MAAM,EAAExD,MAAM,GACVD,WAAW,CACTC,MADS,EAETC,SAFS,EAGTC,WAHS,EAIT8B,YAJS,EAKTC,cALS,EAMT5B,SANS,CADD,GASVoD;GAfN;AAiBD,CA7CD;;ICpHMC,cAAc,GAAG,SAAjBA,cAAiB;MAAGC,iBAAAA;MAAWP,eAAAA;EACnC,IAAMQ,QAAQ,GAAGC,YAAM,CAAC,IAAD,CAAvB;EACA,IAAMC,cAAc,GAAGD,YAAM,CAAiB,IAAjB,CAA7B;EACAd,eAAS,CAAC;IACR,IAAM/C,MAAM,GAAG,IAAIQ,aAAM,CAACuD,MAAX,CAAkBH,QAAQ,CAACI,OAA3B,CAAf;;IACA,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB;;;MAC3BjE,MAAM,CAACkE,SAAP,CAAiB,0BAAAJ,cAAc,CAACE,OAAf,gFAAwBG,YAAxB,KAAwC,CAAzD;MACAnE,MAAM,CAACoE,QAAP,CAAgB,2BAAAN,cAAc,CAACE,OAAf,kFAAwBK,WAAxB,KAAuC,CAAvD;MACArE,MAAM,CAACyB,SAAP;KAHF;;IAKA,IAAM6C,YAAY,GAAG,SAAfA,YAAe;MACnBL,oBAAoB;KADtB;;IAGAA,oBAAoB;IAEpBM,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAkCF,YAAlC,EAAgD,KAAhD;;IAEA,IAAIlB,OAAJ,EAAa;MACXA,OAAO,CAACpD,MAAD,CAAP;;;IAGF,OAAO;MACLA,MAAM,CAACyE,OAAP;MACAF,MAAM,CAACG,mBAAP,CAA2B,QAA3B,EAAqCJ,YAArC;KAFF;GAlBO,EAsBN,EAtBM,CAAT;EAuBA,OACEK,4BAAA,MAAA;IAAKC,GAAG,EAAEd;IAAgBH,SAAS,EAAEA;GAArC,EACEgB,4BAAA,SAAA;IAAQC,GAAG,EAAEhB;GAAb,CADF,CADF;AAKD,CA/BD;;;;;"}